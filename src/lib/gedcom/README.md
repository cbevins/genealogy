# gedcom Subpackage

The **gedcom** subpackage provides a tool for converting a GEDCOM text file(s) (as produced by Ancestry.com or RootsMagic) into a Javascript file(s) that may be directly imported and queried by Nodejs or browser clients.  This is basically a two step process:

1. run the **convertGedcom2Data.js** script to generate a Javascript data file from a GEDCOM text file, and

2. import the Javascript data file into your client code and pass it to constructGedcom() to create a searchable Gedcom instance.


## 1 Create Javascript Data File from GEDCOM

The example script file **convertGedcom2Data.js** reads the **../tmp/Ancestry.ged** and **../RootsMagic.ged** GEDCOM text files and generates corresponding **_gedcomDataAncestry.js** and **_gedcomDataRootsMagic.js** Javascript data files:

```bash
node convertGedcom2Data.js
```
which logs:

```bash
convertGedcom2Data.js ...
    GEDCOM file          : '../tmp/Ancestry.ged' has 94170 records
        file2JsonArray() :  107 msec
        writeFile()      :   97 msec
        created file     : '_gedcomDataAncestry.js'
    GEDCOM file          : '../tmp/RootsMagic.ged' has 131971 records
        file2JsonArray() :  126 msec
        writeFile()      :  119 msec
        created file     : '_gedcomDataRootsMagic.js'
Total elapsed time: 458 msec
```

Each generated file contains a single (long-ish) statement:

```js
// auto-generated by convertGedcom2Data.js on 7/11/2024, 10:21:15 AM
export const _gedcomData = [
    ...
]
```

**NOTE** that only those GEDCOM records whose context is present in the **keepers** array are written to the output file.  See the **convertGedcom2Data.js** file for details.


## 2 Import _gedcomData and Create a **Gedcom** Instance

```js
    import { constructGedcom } from './constructGedcom.js'    // or from '$lib/index.js' if using SvelteKit
    import { _gedcomData } from './_gedcomDataRootsMagic.js' // or from './_gedcomAncestry.js'
    
    // Create the Gedcom instance
    const gedcom = constructGedcom(_gedcomData)

    // Access content of interest from the Gedcom
    const source = gedcom.findFirstContent('', ['HEAD','SOUR','NAME'])
    const created = gedcom.findFirstContent('', ['HEAD','DATE'])
    console.log(`GEDCOM File was created by ${source} on ${created}`)
```

For a more complex example, see the **Sylvan** subpackage.


## Files


### GedcomRecord.js Defines the GedcomRecord Class

GedcomRecord class instances contain a single record of a GEDCOM file.  Because the GEDCOM file represents a nested file structure, the GedcomRecord class maintains references to its parent record and all its child records.

#### Methods

- **context()** returns this instance's record type lineage as an array of strings

- **content()** return this GedcomRecord's content as a (possibly empty) string

- **level()** returns this instance's nesting level as a base-0 integer

- **lineNo()** returns this instance's line number in the original GEDCOM file

- **lines()** returns the number of lines this record occupied in the original GEDCOM file

- **parent()** returns a reference to this instance's parent GedcomRecord

- **subs()** returns an array of references to this instance's child GedcomRecord

- **type()** returns this instance's record type string ('INDI', 'NAME', 'DATE', etc)


### Gedcom.js Defines the Gedcom Class

The Gedcom class holds _gedcomData.js data in a structure that is more readily searched by clients. (The _gedcomData.js file itself is generated by convertGedcom2Data.js from a GEDCOM text file from Ancestry.com or RootsMagic).

Gedcom holds GedcomRecords in a Map() object whose keys are the top 'level 0' record types ('FAM', 'INDI', '_PLAC', etc), and whose entries are another Map() of all the key's toplevel GedcomRecords with their nested GedcomRecord subrecords.
 
#### Methods

- **contexts()** returns an array of [context, count] arrays sorted by context

- **findAllContent(key, context, missing='')** finds ALL GedcomRecords matching the *type* and *context* starting at the top level and returns their content strings in an array

- **findAllRecords(key, context)** finds ALL GedcomRecords matching the *type* and *context* starting at the top level and returns their GedcomRecord references in an array

- **findFirstContent(key, context, missing='')** finds FIRST GedcomRecords matching the *type* and *context* starting at the top level and returns its contents as a string

- **findFirstRecord(key, context)** finds FIRST GedcomRecords matching the *type* and *context* starting at the top level and returns its reference or NULL

- **findHead(type, key)** returns reference to the Level 0 GedcomRecord with *key*

- **topLevel()** returns a reference to the Map() of top-level (Level 0) GedcomRecord instances

- **topLevelCounts()** returns array of [type0, count] arrays of all Level 0 record types

- **topLevelRecordsFor(key)** returns a reference to the Map() of all GedcomRecord instances for top-level *key*


### GedcomReader.js Defines the GedcomReader Class

#### Methods

- **GedcomReader(fileArray)** parses the *fileArray* of GEDCOM records into a GedcomRecords instance.

- **gedcom()** returns the GedcomRecords instance created by the constructor

- **lines()** returns the *fileArray* passed to the constructor

- **messages()** returns a (possibly empoty) array of warning and error messages generated while parsing the GEDCOM file

